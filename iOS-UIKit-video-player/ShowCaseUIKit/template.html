<!DOCTYPE html>
<html>
  <head>
    <meta charset='UTF-8' />
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover" />
    <title>Genius Video Player</title>
    <script src="{baseGeniusLivePlayerUrl}customerId={customerId}&fixtureId={fixtureId}&containerId=geniusLive&width={playerWidth}&height={playerHeight}&controlsEnabled={controlsEnabled}&audioEnabled={audioEnabled}&allowFullScreen={allowFullScreen}&bufferLength={bufferLength}&autoplayEnabled={autoplayEnabled}"></script>
  </head>
  <body style="margin: 0;">
    <div id='container-video' class='container-video'>
      <div id='geniusLive' class='video'>
      </div>
    </div>
  </body>
  <script>
    function runVideoplayer() {
      window.addEventListener('geniussportsmessagebus', async function (event) {
        if (event.detail.type === 'player_ready') {
          const deliveryType = event.detail.body.deliveryType
          const streamId = event.detail.body.streamId
          const deliveryId = event.detail.body.deliveryId
          const geniusSportsFixtureId = event.detail.body.geniusSportsFixtureId
          const dataToPost = {
            endUserSessionId: document.cookie, //user session id
            region: 'CO', //region
            device: 'DESKTOP', //device
          }
          // Calling your getSteramingData function to get the streaming info from your backeand
          const data = await getStreamingData(deliveryType, streamId, deliveryId, geniusSportsFixtureId, dataToPost)
          
          if (Object.keys(data).length > 0 && !data.ErrorMessage) {
            GeniusLivePlayer.player.start(data)
          } else {
            document.getElementById('container-video').style.display = 'none'
          }
        }
        
        // Get Betslip events
        if (event.detail.type === 'multibet-event' || event.detail.type === 'betslip-container-dimensions') {
          const iOSVideoPlayerBridge = window.webkit?.messageHandlers?.gsVideoPlayerBridge;
          if (iOSVideoPlayerBridge) {
            const { type, body } = event.detail;
            iOSVideoPlayerBridge.postMessage({ type, payload: body });
          }
        }

        // Error handling
        if (event.detail.type === 'player_not_ready') {
          const errorsArray = event.detail.body.error
          // Add your custom handling here
        }
      })
    }
    
    async function getStreamingData(deliveryType, streamId, deliveryId, geniusSportsFixtureId, dataToPost) {
      // Here you need to call your backend and retrieve the streaming info based on the given deliveryType, streamId, deliveryId and geniusSportsFixtureId
      return {
    "url": "https://videoplatform.uat.geniuslive.geniussports.com/hls/live/210000/bh0ligkg/frankie_ci_CONTINUOUS_TEST_20000146206/playlist.m3u8",
    "expiresAt": "2024-07-31T21:40:00Z",
    "token": "hdnts=st=1722458400~exp=1722462000~acl=/hls/live/210000/bh0ligkg/frankie_ci_CONTINUOUS_TEST_20000146206/*~id=c77ff232-e57f-475e-9808-456f3932a7fb~data=reg:*|dma:*|dev:*~hmac=a5c3c486db745c1ae3d180baef65e405cdefcb89dc8c60d2d8c26c8bc4f177e2",
    "drm": null
}
    }
    
    window.addEventListener('load', runVideoplayer)
  </script>
</html>
